1. vertical scalability: increase size of a single instance. (use case: non-distributed db)
2. horizontal scalability: increase the number of instances.
3. High Availability: 
    a. related to horizontal scalability
    b. runnning the application in at least 2 data centers(= 2 AZs)
    c. goal is to survive a data center loss.

4. High Avai for EC2:
    1. Vertical: increase instance size (from t2.nano to u-I 2tb I .metal)
    2. horizontal: increase the number of instances(ASG, ELB)
    3. High Avai: Run instances for the same application across multi AZs. (ASG multi AZ, ELB multi AZ)



Load Balancer: servers that forward traffic to multiple servers(EC2 instances) downstream.

    Use case:
        1. Spread load.
        2. Expose a single point of access(DNS) to your application
        3. Seamlessly handle failures of downstream instances.(health check)
        4. regular health check to instances.
        5. provide SSL termination(HTTPS) for your website.
        6. enforce stickiness with cookies
        7. High availability across zones.
        8. Separate public traffic from private ones.

Elastic Load Balancer: MANAGED load balancer
    1. AWS guarantees that it will be working
    2. AWS takes care of upgrades, maintenance, high avai.
    3. integrated with many AWS services(ASG, ECS...)

Health Checks:
    1. done on a port and a route (like endpoint: /health, port: 4567)
    2. If the instance does not respond with a 200(OK), then it is considered unhealthy.

Types: 
    1. Classic LB(deprecating)
    2. Application LB (HTTP, HTTPS, WebSocket)
    3. Network LB (TCP, TLS, UDP)
    4. Gateway LB (Operate at layer 3, network layer.  IP Protocol)

The EC2 instances behind your ELB should have a security group that only allows inbound traffic of type HTTP from the ELB that uses a particular security group.




Application LB: at layer 7 (HTTP)
    
    1. Load balancing to multiple HTTP applications across machines(target groups)
    2. Load balancing to multiple applications on the same machine(ex: containers)
    3. Support for HTTP/2 and WebSocket.
    4. Support redirect(From HTTP to HTTPS for example)
    5. Routing tables to different target groups
        a. routing based on path in URL(example.com/users and example.com/posts)
        b. routing based on hostname in URL(one.example.com and other.example.com)
        c. routing based on query strings and headers(example.com/users?id=123&order=false)

    1. ALB are a great fit for micro services and container based application(Docker and Amazon ECS)
    2. Has a port mapping feature to redirect to a dynamic port in ECS.


a target Groups can consist of:
    
    1. EC2 instances(can be managed by ASG) - HTTP
    2. EC2 tasks(managed by ECS itself) - HTTP 
    3. Lambda functions - HTTP request is translated into a JSON event.
    4. IP Addresses - must be private IPs.
    
    ALB can route to multiple target groups.
    Health checks are at the target group level.


Client IP will be inserted into header: X-Forwarded-For. 



Network Load Balancer: operates at Layer 4, allowing:
    1. Forward TCP  & UDP traffic to your instances.
    2. Handle millions of requests per second.
    3. Ultra-low latency

    NLB has one static IP per AZ, and supports assigning Elastic IP(helpful for whitelisting specific IP)

    NLB are used for extreme performance, TCP or UDP traffic

    Target Groups:
        1. EC2 instances.
        2. Private IP addresses.
        3. Application Load Balancer.(static ip for az + powerful rules for http)

        Health Checks support the TCP, HTTP and HTTPS protocol

Gateway LB: additional "firewall" that all traffic must go through first for security check.



Sticky Sessions(Session Affinity): the same client is always redirected to the same instance behind a load balancer.
    1. Can be enabled for CLB, ALB and NLB.
    2. there is a cookie as part of request from clients, used for stickiness. This cookie has an expiration date you control. when the cookie expires, the request may be redirected to another instance.

    Use case: make sure user does not lost his session data.

    Drawback: may bring imbalance to the load over the backend EC2 instances.

    Two types of cookie for sticky sessions:
        1. Application-based Cookies
            - Custom cookie
                1. Generated by the target.
                2. Can include any custom attributes required by the application.
                3. Cookie name must be specified individually for each target group.
                4. Don't use AWSALB, AAWSALBAPP, AWSALBTG(reserved for use by the ELB)
            - Application cookie
                1. Generated by the load balancer
                2. Cookie name is AWSALBAPP
        2. Duration-based Cookies
            1. Generated by the LB
            2. Cookie name is AWSALB for ALB, AWSELB for CLB

Cross-Zone Load Balancing:

    1. Each AZ gets its own Load Balancer Instance.
    2. The load balancer instance belongs to the same general load balancer.
    3. With cross zone load balancing, each load balancer instance distributes evenly across all registered instances in ALL AZ.

    example: 
        AZ-a, AZ-b, each has its own LB instance. AZ-a has 2 EC2 instances, AZ-b has 8 instances.
        
        Received 100 requests on the general LB, 50 goes to AZ-a LB instance, 50 goes to AZ-b LB instance.

        With Cross-Zone Load Balancing: 
            AZ-a LB instance will assign 10 requests to each of its instances and assign the remainning 30 to instances in AZ-b, even though they are not in the same AZ as the LB instance.

        Without:
            AZ-a LB instance will assign 25 requests to each of its instances.

    For ALB: 
        1. Enabled by default(can be disabled at target group level)
        2. No charges for inter AZ data.

    For NLB and Gateway LB:
        1. Disabled by default
        2. You pay charges for inter AZ if enabled


SSL Cert:
    SNI: Server Name Indication
    
    With SNI, you can load multiple SSL cert onto one ELB, each corresponds to their own target group.

    SNI is a newer protocol and requres the client to indicate the hostname of the target server in the initial SSL handshake.

    SNI only works for ALB and NLB, CloudFront.
    It does NOT work for CLB.

Connection Draining
    Naming:
        Connection Draining for CLB
        Deregistration Delay for ALB and NLB

    Concept:
        No new connection to instance on Draining status, but the existing ones are given specified time to complete, after an instance has been deregistered but not yet terminated.

    Specified time range: 1 to 3600 seconds(default: 300 sec)
    Can be disabled(set value to 0)
    Set to low value if your requests are short.
    set to large value if your requests can take long(upload video...)


Auto Scaling Group(ASG)



    